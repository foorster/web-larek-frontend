# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:

- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:

- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```

## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных, используемые в приложении

#### Продукт

```
interface IProduct {
	id: string;
	description: string;
	image: string;
	title: string;
	category: string;
	price: number | null;
    inbasket: boolean // Информация о том, находится ли товар в корзине
}
```

---

#### Пользователь

```
interface IUserInfo {
	address: string;
	email: string;
	phone: number;
}
```

---

#### Заказ

```
interface IOrder {
	id: string;
	total: number;
}
```

---

#### Корзина (хранение списка товаров и их общей стоимости)

```
interface IBasket {
	list: TBasketProduct[];
    total: number;
}
```

#### Тип для корзины с заказами

```
type TBasketProduct = Pick<IProduct, 'id' | 'title' | 'price'>;
```

---

#### Отображение модалки с корзиной

```
interface IModalBasket {
    showListBasket(product: TBasketProduct[], total:number): void // Показываем список товаров
    actionProductBasket(id:string, inbasket: boolean): void // Удаляем или добавляем один продукт
    clearListBasket():void // Очищаем корзину
}
```

---

#### Тип для модалки с оплатой заказа

```
type TPay = Pick<IUserInfo, 'address'>;
```

---

#### Тип для модалки с контактами

```
type TContact = Pick<IUserInfo, 'email' | 'phone'>;
```

---

#### Тип для модалки успешного оформления заказа

```
type TSucсess = Pick<IOrder, 'total'>;
```

## Архитектура приложения

Код приложения разделен на слои солгласно парадигме MVP

- слой представления - отвечает за отображение данных на странице
- слой данных - отвечает за хранение и изменение данных
- презентер - отвечает за связь представления и данных

### Базовый код

#### Класс Api

Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов. Методы:

- get - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- post - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется POST запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс EventEmitter

Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.
Основные методы, реализуемые классом описаны интерфейсом IEvents:

- `on` - подписка на событие
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие

---

---

### Слой данных

#### Класс ProductsData

Класс отвечает за хренение и логику работы с данными продуктов. \
Конструктор класса принимает инстант брокера событий.

В полях класса хранятся следующие данные:

- \_products: IProduct[] - массив, в котором хранятся все продукты (записывать туда не можем, можем только получать)
- \_preview: string | null - свойство, в котором хранится айдишник выбранного продукта, который мы можем просматривать при нажатии/выборе
- events: IEvents - экземпляр класса `EventEmitter` для инициализации событий при изменении данных.

- addProduct(product: IProduct): void - метод, позволяющий добавить один продукт в корзину
- deleteProduct(productId: string): void - метод, позволяющий удалить один продукт из корзины
- updateProduct(product: IProduct): void - метод, позволяющий обновить продукт (в случае, если добавили/убрали из корзины)
- getProduct(productId: string): IProduct - метод, позволяющий получить один продукт по айдишнику
- checkProduct(productId: string): boolean - метод, проверяющий в корзине продукт или нет

---

#### Класс BasketData

Класс отвечает за хренение и логику работы с массивом добавленных в корзину продуктов. \
Конструктор класса принимает инстант брокера событий.

- list: TBasketProduct[] - массив продуктов, которые добавлены в корзину
- total: number - сумма всех продуктов, добавленных в корзину
- showListBasket(product: TBasketProduct[], total:number): void - показывает список товаров и стоимость
- addProductBasket(productId: string): IProduct - метод описывающий добавление одного продукта в корзину
- deleteProductBasket(productId: string): void - метод, описывающий удаление одного продукта из корзины
- updateBasket(productId: string): boolean - метод, который обновляет корзину
- countProducts(productId: string): number - счетчик продуктов, проверяет есть ли продукт в корзине и если есть, прибавляет единицу (Возможно его надо перенести функцией в updateBasket)
- clearListBasket(): void - очищает корзину полностью

---

#### Класс UserData

Класс отвечает за хренение и логику работы с данными пользователя. \
Конструктор класса принимает инстант брокера событий.

- getUserInfo(): IUserInfo - метод, позволяющий получить информацию о пользователе
- setUserInfo(userData: IUserInfo): void - метод, позволяющий установить информацию о пользователе

---

---

### Классы представления

Все классы представления отвечают за отображение внутри контейнера (DOM-элемент) передаваемых в них данных.

---

#### Класс Product

Реализует любой продукт в списке (В трех состояниях - на главной странице, при открытии модалки и в корзине). Устанавливает слушатели на кнопки добавления/удаления в/из корзины.

constructor(container: HTMLElement, events: IEvents) - принимает DOM карточки и брокер событий

##### Элементы

- descriptionProduct - HTMLElement // необязательное свойство
- imageProduct - HTMLImageElement // необязательное свойство
- titleProduct - HTMLElement
- categoryProduct - HTMLElement // необязательное свойство
- priceProduct - HTMLElement
- basketButton - HTMLElementButton - кнопка, позволяющая закинуть продукт в корзину

##### Методы

- changeButton(): void - метод, позволяющий поменять вид кнопки
- disableButton(): void - метод, который отображает заблокированную кнопку (если товар бесценный)

---

#### Класс Modal

Реализует любое универсальное модальное окно. Также предоставляет методы `open` и `close` для управления отображением модального окна. Устанавливает слушатели на мышку для закрытиия модалки при клике на крестик.

constructor(content: HTMLElement, events: IEvents) - принимает DOM модалки и брокер событий

##### Методы

- setInfo(): void - метод, позволяющий установить информацию в модалку
- open(content: HTMLElement): void - открытие модалки
- close(): void - закрытие модалки
- reset(): void - сброс содержимого модалки

---

#### Класс Basket

Реализует корзину. Показывает список (массив продуктов) и итоговую стоимость в модалке.

constructor(list: HTMLElement, total: HTMLElement, events: IEvents) - принимает список добавленных в корзину продуктов, итоговую сумму этих продуктов и брокер событий

##### Элементы

- arrange: HTMLElementButton - кнопка, позволяющая оформить корзину

---

#### Класс Pay

Реализует оформление оплаты заказа. Показывает возможные варианты оплаты, просит ввести адрес и дает возможность перейти далее.

constructor(content: HTMLElement, events: IEvents) - принимает DOM разметки и брокер событий

##### Элементы

- onlinePay: HTMLElementButton - кнопка, отвечающая за онлайн оплату
- cashPay: HTMLElementButton - кнопка, отвечающая за оплату при получении
- address: HTMLInputElement - инпут, в который надо ввести адрес
- nextPay: HTMLElementButton - кнопка, позволяющая перейти далее

##### Методы

- setAddress(): void - метод, который позволяет установить адрес
- payChoice(): void - метод, отвечающий за выбор способа оплаты

---

#### Класс Info

Реализует отображение информации о покупателе. Просит заполнить два инпута (почта и телефон) и дает возможность перейти далее.

constructor(content: HTMLElement, events: IEvents) - принимает DOM разметки и брокер событий

##### Элементы

- email: HTMLInputElement - инпут, в который надо ввести почту
- phone: HTMLInputElement - инпут, в который надо ввести номер
- nextInfo: HTMLElementButton - кнопка, позволяющая перейти далее

##### Методы

- setEmail(): void - метод, который позволяет установить почту
- setPhone(): void - метод, который позволяет установить номер

---

#### Класс SuccessfulOrder

Реализует отображение информации о успешно сформированном заказе. Ничего не просит и дает возможность нажать на кнопку "за новыми покупками".

constructor(content: HTMLElement, events: IEvents) - принимает DOM разметки и брокер событий

##### Элементы

- nextOrder: HTMLElementButton - кнопка, позволяющая завершить покупку

---

---

### Слой коммуникации

### Класс AppApi

Принимает конструктор экземпляр класса Api и предоставляет методы реализующий взаимодействие с бэкендом сервиса.

## Взаимодействие компонентов

Код, описывающий взаимодействие представления и данных между собой находится в файле `index.ts`, выполняющем роль презентера.

Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий, описанных в `index.ts`.

В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.

_Список всех событий, которые могут генерироваться в системе:_
_События изменения данных (генерируются классами моделями данных)_

- `_products:changed` - изменение массива продуктов (в общем)
- `list:changed` - изменение массива продуктов (в корзине)
- `product:selected` - изменение структуры выбранного товара в зависимости от того, где мы его просматриваем

_События, возникающие при взаимодействии пользователя с интерфейсом (генерируются классами, отвечающими за представление)_

### Взаимодействие с модальными окнами

- `Modal:open` - открытие ллюбого модального окна

- `Product:select` - выбор контента продукта для отображения в модальном окне
- `Basket:select` - выбор контента корзины для отображения в модальном окне
- `Pay:select` - выбор контента, отвечающего за оплату для отображения в модальном окне
- `Info:select` - выбор контента, отвечающего за контакты для отображения в модальном окне
- `SuccessfulOrder:select` - выбор контента, отвечающего за успешное оформление заказа для отображения в модальном окне

### Взаимодействие с формой товара

- `basketButton` - добавление продукта в корзину

### Взаимодействие с формой корзины

- `arrange:submit` - сохранение данных по заказу

### Взаимодействие с формой оплаты

- `address:input` - изменение данных в форме с оплатой заказа
- `onlinePay:select` - выбор кнопки для оплаты онлайн в форме с оплатой заказа
- `cashPay:select` - выбор кнопки для оплаты наличными в форме с оплатой заказа
- `nextPay:submit` - сохранение данных по оплате в модальном окне

### Взаимодействие с формой контактов

- `email:input` - изменение данных почты в форме с контактами
- `phone:input` - изменение данных телефона в форме с контактами
- `nextInfo:submit` - сохранение данных по контактам в модальном окне

### Взаимодействие с формой успешного оформления заказа

- `nextOrder:submit` - завершение оформления заказа
